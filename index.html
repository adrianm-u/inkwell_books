<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inkwell Books</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div class="header">
        <a href="index.html">
            <img src="Bilder/logo.png">
        </a>
        <div id="search_box">
            <input type="search" id="search" placeholder="Søk..." data-search autocomplete="off">
            <button id="search-button"></button>
        </div>
        <ul>
            <li id="loggInn_knapp"><a href="logg_inn.html">Logg inn</a></li>
            <li><a href="handlekurv.html">Handlekurv</a></li>
        </ul>
    </div>

    <nav class="navigation_bar">
        <ul>
            <li><a href="index.html">Bøker</a></li>
            <li><a href="om_oss.html">Om oss</a></li>
        </ul>
    </nav>

    <main>

    </main>

    <script>
        let produkter = [
            {
                imgSrc: "Bilder/spilleren.jpg",
                tittel: "Spilleren",
                pris: "449,-"
            },
            {
                imgSrc: "Bilder/en_dag.jpg",
                tittel: "En dag",
                pris: "149,-"
            },
            {
                imgSrc: "Bilder/elskede_barn.jpg",
                tittel: "Elskede barn",
                pris: "249,-"
            },
            {
                imgSrc: "Bilder/ravnejenta.jpg",
                tittel: "Ravnejenta",
                pris: "79,-"
            },
            {
                imgSrc: "Bilder/bestselger.jpg",
                tittel: "Bestselger",
                pris: "299,-"
            },
            {
                imgSrc: "Bilder/illlandet.jpg",
                tittel: "Ildlandet",
                pris: "199,-"
            },
            {
                imgSrc: "Bilder/kokain.jpg",
                tittel: "Kokain",
                pris: "201,-"
            },
            {
                imgSrc: "Bilder/skygger.jpg",
                tittel: "Skygger",
                pris: "299,-"
            },
            {
                imgSrc: "Bilder/jeg_skal.jpg",
                tittel: "Jeg skal hente deg",
                pris: "450,-"
            },
            {
                imgSrc: "Bilder/mordene.jpg",
                tittel: "Mordene på Fleat House",
                pris: "250,-"
            },
            {
                imgSrc: "Bilder/hafni.jpg",
                tittel: "Hafni forteller",
                pris: "350,-"
            },
            {
                imgSrc: "Bilder/forsoneren.jpg",
                tittel: "Forsoneren",
                pris: "299,-"
            }
        ]

        let mainEl = document.querySelector("main");
        let productResultsEl = document.createElement("div");
        productResultsEl.setAttribute("id", "product_results");

        function lagElement() {
            for (let i = 0; i < produkter.length; i++) {
                let bookItemEl = document.createElement("div");
                let imgEl = document.createElement("img");
                let tittelEl = document.createElement("h1");
                let prisEl = document.createElement("p")
                let knappEl = document.createElement("button");

                knappEl.addEventListener("click", leggKurv);

                bookItemEl.setAttribute("class", "book_item");
                imgEl.setAttribute("src", produkter[i].imgSrc);
                bookItemEl.setAttribute("data-index", i);
                tittelEl.classList.add("product_titel");
                imgEl.classList.add("product_cover");
                prisEl.classList.add("product_price");
                knappEl.classList.add("product_button");

                tittelEl.innerText = produkter[i].tittel;
                prisEl.innerText = produkter[i].pris;
                knappEl.innerText = "Legg i kurven!"
                knappEl.dataset.index = i;


                bookItemEl.appendChild(imgEl);
                bookItemEl.appendChild(tittelEl);
                bookItemEl.appendChild(prisEl);
                bookItemEl.appendChild(knappEl);

                productResultsEl.appendChild(bookItemEl);
                mainEl.appendChild(productResultsEl);

            }
        }

        lagElement();


        function leggKurv() {
            let produktIndeks = event.target.dataset.index;
            let valgtProdukt = produkter[produktIndeks];

            let kurvProdukter = JSON.parse(localStorage.getItem("kurvProdukter")) || [];

            let eksisterendeProdukt = kurvProdukter.find(item => item.tittel === valgtProdukt.tittel);

            if (eksisterendeProdukt) {
                eksisterendeProdukt.antall++;
            } else {
                valgtProdukt.antall = 1;
                kurvProdukter.push(valgtProdukt);
            }

            localStorage.setItem("kurvProdukter", JSON.stringify(kurvProdukter));

            window.location.href = "handlekurv.html";
        }

        let searchInput = document.querySelector("[data-search]");

        searchInput.addEventListener("input", e => {
            let value = e.target.value.toLowerCase();
            produkter.forEach(produkt => {
                let bookItemEl = document.querySelector('.book_item[data-index="' + produkter.indexOf(produkt) + '"]'); // Finn riktig bok-element ved hjelp av indeksen
                let isVisible = produkt.tittel.toLowerCase().includes(value);
                if (bookItemEl) {
                    bookItemEl.classList.toggle("hide", !isVisible);
                }
            });
        });

        let loggInnEl = document.querySelector("#loggInn_knapp")

        if (sessionStorage.getItem("navn") !== null) {
            loggInnEl.innerHTML = "<a href='logg_inn.html'>Hi " + sessionStorage.getItem("navn") + "!</a>";
        }
    </script>


</body>

</html>